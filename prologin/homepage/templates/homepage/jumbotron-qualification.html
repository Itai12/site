{% load i18n %}

<div class="col-sm-4">
  <div class="tl-block {% if qualif.is_active %}active{% endif %}">
    <div class="row">
      <div class="col-xs-5 col-sm-12">
        <h4>{% trans "Qualification" %}</h4>
        <p class="date">{{ qualif.date_begin|date:"d b Y"|default:no_such_date }}
          â†’&nbsp;{{ qualif.date_end|date:"d b Y"|default:no_such_date }}</p>
      </div>
      <div class="col-xs-7 col-sm-12">
        <div class="desc">
        {% if edition.is_active %}
          {% if qualif.is_in_future %}
            {# qualif are in future #}
            <p>
              <i class="fa fa-clock-o"></i>
              <strong>{% trans "Qualifications for this year's edition will be announced as soon as possible." %}</strong>
            </p>
            <p class="text-center">
              <a href="{% url 'problems:index' %}" class="btn btn-default btn-block">
                <i class="fa fa-tachometer"></i> {% trans "Start training!" %}
              </a>
            </p>
          {% else %}
            {#    qualif are the current phase #}
            {# OR qualif are done, but edition is still active (semifinals, final) #}
            <p>
              {% if request.current_qcm %}
                {% blocktrans %}A quiz and {{ problems_count }} problems to solve online.{% endblocktrans %}
              {% else %}
                {% blocktrans %}{{ problems_count }} problems to solve online.{% endblocktrans %}
              {% endif %}
            </p>
            {% if qualif.is_active %}
              {# qualif are the current phase #}
              {% if request.user.is_authenticated %}
                {# contestant logged in #}
                <ul class="list-unstyled checklist">
                  {% if current_qcm %}
                    {# qualif have qcm #}
                    {% if qcm_completed %}
                      <li class="text-success">
                        <a href="{% url 'qcm:display' edition.year %}">
                          <i class="fa fa-check-square-o"></i>
                          {% trans "Quiz completed" %}
                        </a>
                      </li>
                    {% else %}
                      <li class="text-danger">
                        <a href="{% url 'qcm:display' edition.year %}">
                          <i class="fa fa-square-o"></i>
                          {% trans "Complete the quiz" %}
                        </a>
                      </li>
                    {% endif %}
                  {% endif %}
                  {# /qualif have qcm #}
                  {# checklist: solved problem #}
                  <li class="text-{% if problems_completed == problems_count %}success{% elif problems_completed > 0 %}warning{% else %}danger{% endif %}">
                    <a href="{% url 'problems:challenge' edition.year 'qualification' %}">
                      <i class="fa fa-{% if problems_completed == problems_count %}check-{% endif %}square-o"></i>
                      {% blocktrans %}{{ problems_completed }}/{{ problems_count }} problems tackled{% endblocktrans %}
                    </a>
                  </li>
                  {# checklist: personnal details #}
                  <li
                    class="text-{% if contestant.is_complete_for_semifinal %}success{% else %}danger{% endif %}">
                    <a href="{% url 'contest:qualification_summary' edition.year %}">
                      <i class="fa fa-{% if contestant.is_complete_for_semifinal %}check-{% endif %}square-o"></i>
                      {% trans "Review the extra details" %}
                    </a>
                  </li>
                </ul>
              {% else %}
                {# anonymous #}
                <p class="text-center signin">
                  <a href="{% url 'users:register' %}" class="btn btn-default btn-block">
                    <i class="fa fa-rocket"></i>
                    {% trans "Register now!" %}
                  </a>
                </p>
              {% endif %}
            {% else %}
              {# qualif are done #}
              {% if request.user.is_authenticated %}
                {% if edition.qualification_corrected %}
                  {# results are available #}
                  {% if contestant.is_assigned_for_semifinal %}
                    {# complete/correct submission and accepted #}
                    {# :-) #}
                    <p>
                      <i class="fa fa-check text-success"></i>
                      <strong>{% trans "Congratulations! You have been selected for the regional events." %}</strong>
                    </p>
                    {% if not lastsemi.is_finished %}
                      {# ask for paperwork if semifinals are not finished yet #}
                      <p>{% trans "Please proceed to download your invitation papers and start training for the next step!" %}</p>
                    {% endif %}
                  {% elif contestant.is_ruled_out_for_semifinal %}
                    {# complete/correct submission but not accepted #}
                    {# :-( #}
                    <p>
                      <i class="fa fa-times text-danger"></i>
                      <strong>{% trans "Sorry, this year your application was not selected for the regional events." %}</strong>
                    </p>
                    <p>{% trans "Do not lose hope though! Start training right away so you can perfect your knowledge of algorithms and programming, and try again next year. Best luck!" %}</p>
                  {% elif contestant.is_complete_for_semifinal %}
                    {# complete but "unassigned", wtf? #}
                    <p>
                      <i class="fa fa-bug text-danger"></i>
                      <strong>{% trans "There is a problem with your application. Please contact the staff as soon as possible." %}</strong>
                    </p>
                  {% else %}
                    {# incomplete submission #}
                    <p>
                      <i class="fa fa-times text-danger"></i>
                      <strong>{% trans "You did not apply for the contest this year." %}</strong>
                    </p>
                    <p>{% trans "Come back for the next edition!" %}</p>
                  {% endif %}
                {% else %}
                  {# results not available yet #}
                  <p>
                    <i class="fa fa-clock-o"></i>
                    <strong>{% trans "The jury's decision will soon be announced by email and on the website." %}</strong>
                  </p>
                  <p>{% trans "You can start ahead by training for the regional events." %}</p>
                {% endif %}
              {% else %}
                {# anonymous #}
                <p>{% trans "Log in to check if you were selected for the regional events." %}</p>
                <p>
                  <a href="{% url 'users:login' %}" class="btn btn-default btn-block"><i class="fa fa-user"></i> {% trans "Login" %}</a>
                </p>
              {% endif %}
            {% endif %}
          {% endif %}
        {% else %}
          {# edition is not active (post final) #}
          <p>
            <i class="fa fa-calendar-check-o"></i>
            <strong>{% blocktrans with year=edition.year %}Prologin {{ year }} is now finished!{% endblocktrans %}</strong>
          </p>
          {% url 'archives:index' as url %}
          <p>{% blocktrans %}The final's results will be published on <a href="{{ url }}">the archives</a> as soon as they are available.{% endblocktrans %}</p>
          <p>{% trans "Stay tuned for next year's edition. We will announce when it starts on this website and by email." %}</p>
          <p>
            <a href="{% url 'problems:index' %}" class="btn btn-default btn-block">
              <i class="fa fa-tachometer"></i> {% trans "Start training!" %}
            </a>
          </p>
        {% endif %} {# edition.is_active #}
        </div>
      </div>
    </div>
  </div>
</div>